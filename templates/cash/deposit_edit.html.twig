{% extends 'layouts/main.html.twig' %}
{% block title %}Modifier un dépôt{% endblock %}

{% block page_header %}
  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
    <div>
      <h4 class="fs-16 mb-1">Modifier un dépôt</h4>
      <p class="text-muted mb-0">
        Mouvement #{{ movement.id }} — créé le {{ movement.createdAt|date('d/m/Y H:i') }}
        {% if movement.createdBy %} par {{ movement.createdBy.email ?? movement.createdBy.userIdentifier }}{% endif %}
      </p>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-ghost-secondary" href="{{ path('cash_index', { d: movement.createdAt|date('Y-m-d') }) }}">
        <i class="ri-arrow-left-line align-middle me-1"></i> Retour
      </a>
    </div>
  </div>
{% endblock %}

{% block body %}
  {% include 'partials/flashes.html.twig' ignore missing %}

  <div class="card">
    <div class="card-header d-flex align-items-center justify-content-between">
      <h5 class="card-title mb-0">Éditer l’injection</h5>
      <span class="badge bg-success-subtle text-success">Type : IN</span>
    </div>

    <div class="card-body">
      {{ form_start(form, {attr: {novalidate: 'novalidate', class: 'needs-validation'}}) }}

        {# Montant #}
        <div class="mb-3">
          {{ form_label(form.amount, 'Montant', {label_attr: {class: 'form-label'}}) }}
          <div class="input-group">
            <span class="input-group-text"><i class="ri-coins-line"></i></span>
            {{ form_widget(form.amount, {attr: {class: 'form-control', placeholder: '0', required: true}}) }}
            <span class="input-group-text">MRU</span>
          </div>
          {{ form_errors(form.amount) }}
        </div>

        {# Source des fonds #}
        <div class="mb-3">
          {{ form_label(form.source, 'Source des fonds', {label_attr: {class: 'form-label'}}) }}
          <div class="input-group">
            <span class="input-group-text"><i class="ri-bank-card-2-line"></i></span>
            {{ form_widget(form.source, {attr: {class: 'form-select', required: true}}) }}
          </div>
          {{ form_errors(form.source) }}
        </div>

        {# Notes #}
        <div class="mb-3">
          {{ form_label(form.notes, 'Notes', {label_attr: {class: 'form-label'}}) }}
          {{ form_widget(form.notes, {attr: {class: 'form-control', rows: 3, placeholder: 'Commentaire ou motif', required: true}}) }}
          {{ form_errors(form.notes) }}
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">
            <i class="ri-save-3-line align-middle me-1"></i> Enregistrer
          </button>
        </div>

      {{ form_end(form) }}
    </div>
  </div>

  {# Formulaire SUPPRIMER séparé (pas de nesting) #}
  <div class="card mt-3">
    <div class="card-body d-flex justify-content-between align-items-center">
      <div class="text-muted">
        Supprimer définitivement ce dépôt. Action irréversible.
      </div>
      <form method="post"
            action="{{ path('cash_deposit_delete', { id: movement.id }) }}"
            onsubmit="return confirm('Supprimer définitivement ce dépôt ?');">
        <input type="hidden" name="_token" value="{{ csrf_token('delete_deposit_' ~ movement.id) }}">
        <button class="btn btn-outline-danger">
          <i class="ri-delete-bin-6-line align-middle me-1"></i> Supprimer
        </button>
      </form>
    </div>
  </div>
{% endblock %}
