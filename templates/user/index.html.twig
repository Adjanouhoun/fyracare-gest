{% extends 'layouts/main.html.twig' %}
{% block title %}Utilisateurs{% endblock %}

{% block page_header %}
  <div class="d-flex align-items-center justify-content-between">
    <div>
      <h4 class="fs-16 mb-1">Utilisateurs</h4>
      <p class="text-muted mb-0">Gestion des comptes</p>
    </div>
    <a class="btn btn-primary" href="{{ path('app_user_new') }}">
      <i class="ri-user-add-line align-middle me-1"></i> Nouvel utilisateur
    </a>
  </div>
{% endblock %}

{% block body %}
  {% include 'partials/flashes.html.twig' %}

  <div class="card"><div class="card-body">
    <div class="table-responsive table-card">
      <table class="table align-middle table-hover">
        <thead class="table-light">
          <tr>
            <th>Nom</th>
            <th>Email</th>
            <th>Fonction</th>
            <th>Rôles</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
        {% for u in users %}
          <tr>
            <td>{{ u.fullname }}</td>
            <td>{{ u.email }}</td>
            <td>{{ u.fonction ?: '—' }}</td>
            <td>
              {% for r in u.roles %}
                <span class="badge bg-secondary-subtle text-secondary">{{ r }}</span>
              {% endfor %}
            </td>
            <td class="text-end">
              <div class="btn-group">
                <a class="btn btn-sm btn-soft-secondary" href="{{ path('app_user_show', {id: u.id}) }}"><i class="ri-eye-line"></i></a>
                <a class="btn btn-sm btn-soft-info" href="{{ path('app_user_edit', {id: u.id}) }}"><i class="ri-pencil-line"></i></a>
                <form method="post" action="{{ path('app_user_delete', {id: u.id}) }}" onsubmit="return confirm('Supprimer cet utilisateur ?');" class="d-inline">
                  <input type="hidden" name="_token" value="{{ csrf_token('delete_user_' ~ u.id) }}">
                  <button class="btn btn-sm btn-soft-danger"><i class="ri-delete-bin-line"></i></button>
                </form>
              </div>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="5" class="text-center text-muted">Aucun utilisateur.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div></div>
{% endblock %}
