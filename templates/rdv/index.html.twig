{% extends 'layouts/main.html.twig' %}

{% block title %}Rendez-vous du jour{% endblock %}

{# Badge statut sans constant() #}
{% macro status_badge(s) %}
  {% set map = {
    'HONORE':   'bg-success-subtle text-success',
    'CONFIRME': 'bg-primary-subtle text-primary',
    'ANNULE':   'bg-danger-subtle text-danger',
    'ABSENT':   'bg-warning-subtle text-warning'
  } %}
  <span class="badge {{ map[s] ?? 'bg-info-subtle text-info' }}">{{ s }}</span>
{% endmacro %}
 
{% block body %} 

    <div class="row mb-3">
      <div class="col">
        <h4 class="fs-16 mb-1">Rendez-vous du jour — {{ today|date('d/m/Y') }}</h4>
        <p class="text-muted mb-0">Liste des RDV planifiés aujourd’hui.</p>
      </div>
      <div class="col-auto d-flex gap-2">
        <a href="{{ path('app_rdv_all') }}" class="btn btn-soft-secondary">
          <i class="ri-list-check-2 align-middle me-1"></i> Tous les rendez-vous
        </a>
      </div>
    </div>

    <div class="card card-animate">
      <div class="card-header d-flex align-items-center justify-content-between">
        <h4 class="card-title mb-0">Liste</h4>
      </div>

      <div class="card-body">
        {% if pagination|length > 0 %}
          <div class="table-responsive table-card">
            <table class="table table-hover align-middle table-nowrap mb-0">
              <thead class="table-light">
                <tr>
                  <th>Heure</th>
                  <th>Client</th>
                  <th>Prestation</th>
                  <th>Statut</th>
                  <th class="text-end">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for rdv in pagination %}
                  <tr>
                    <td>
                      {{ rdv.startAt ? rdv.startAt|date('H:i') : '—' }}
                      {% if rdv.endAt %}– {{ rdv.endAt|date('H:i') }}{% endif %}
                    </td>
                    <td>{{ rdv.client }}</td>
                    <td>{{ rdv.prestation }}</td>
                    <td>{{ _self.status_badge(rdv.status) }}</td>
                    <td class="text-end">
                      <div class="btn-group">
                        <a class="btn btn-sm btn-soft-secondary" href="{{ path('app_rdv_show', {id: rdv.id}) }}"><i class="ri-eye-line"></i></a>
                        <a class="btn btn-sm btn-soft-info" href="{{ path('app_rdv_edit', {id: rdv.id}) }}"><i class="ri-pencil-line"></i></a>
                        {% set dejaPaye = rdv.payments|length > 0 %}
                        <a class="btn btn-sm btn-soft-success {{ dejaPaye ? 'disabled' : '' }}"
                          {% if not dejaPaye %}
                            href="{{ path('app_payment_new', { rdv: rdv.id }) }}"
                          {% else %}
                            href="#" tabindex="-1" aria-disabled="true" title="Déjà payé"
                          {% endif %}>
                          <i class="ri-cash-line"></i>
                        </a>
                      </div>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <div class="mt-3">
            {{ knp_pagination_render(pagination) }}
          </div>
        {% else %}
          <div class="text-muted">Aucun rendez-vous aujourd’hui.</div>
        {% endif %}
      </div>
    </div>
 
{% endblock %}
